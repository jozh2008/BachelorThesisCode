<tool name="OTB.LSMSSegmentation" id="otb_lsmssegmentation" version="1.0.0">
  <description>This application performs the second step of the exact Large-Scale Mean-Shift segmentation workflow (LSMS) [1].</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayin False  isArrayinpos False  output_data_out $output_data_out  name OTB.LSMSSegmentation in $in
inpos $inpos
out $out
spatialr $spatialr
ranger $ranger
minsize $minsize
tilesizex $tilesizex
tilesizey $tilesizey
tmpdir '$tmpdir'
cleanup $cleanup
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out]]></command>
  <inputs>
    <param name="in" type="data" optional="false" label="The filtered image, corresponding to the fout output parameter of the MeanShiftSmoothing application." help="The filtered image, corresponding to the fout output parameter of the MeanShiftSmoothing application. The following data types are allowed in the txt file:  jpeg, tiff, png" format="txt"/>
    <param name="inpos" type="data" optional="false" label="The filtered position image, corresponding to the foutpos output parameter of the MeanShiftSmoothing application." help="The filtered position image, corresponding to the foutpos output parameter of the MeanShiftSmoothing application. The following data types are allowed in the txt file:  jpeg, tiff, png" format="txt"/>
    <param name="out" type="select" optional="false" label="This output contains the segmented image, where each pixel value is the unique integer label of the segment it belongs to. It is recommended to set the pixel type to uint32." help="This output contains the segmented image, where each pixel value is the unique integer label of the segment it belongs to. It is recommended to set the pixel type to uint32.">
      <option value="double">double</option>
      <option value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option selected="true" value="uint8">uint8</option>
    </param>
    <param name="spatialr" type="float" value="5" optional="true" label="Threshold on Spatial distance to consider pixels in the same segment. A good value is half the spatial radius used in the MeanShiftSmoothing application (spatialr parameter)." help="Threshold on Spatial distance to consider pixels in the same segment. A good value is half the spatial radius used in the MeanShiftSmoothing application (spatialr parameter)."/>
    <param name="ranger" type="float" value="15" optional="true" label="Threshold on spectral signature euclidean distance (expressed in radiometry unit) to consider pixels in the same segment. A good value is half the range radius used in the MeanShiftSmoothing application (ranger parameter)." help="Threshold on spectral signature euclidean distance (expressed in radiometry unit) to consider pixels in the same segment. A good value is half the range radius used in the MeanShiftSmoothing application (ranger parameter)."/>
    <param name="minsize" type="integer" value="0" optional="true" label="Minimum Segment Size. If, after the segmentation, a segment is of size lower than this criterion, the segment is discarded." help="Minimum Segment Size. If, after the segmentation, a segment is of size lower than this criterion, the segment is discarded."/>
    <param name="tilesizex" type="integer" value="500" optional="false" label="Size of tiles along the X-axis for tile-wise processing." help="Size of tiles along the X-axis for tile-wise processing."/>
    <param name="tilesizey" type="integer" value="500" optional="false" label="Size of tiles along the Y-axis for tile-wise processing." help="Size of tiles along the Y-axis for tile-wise processing."/>
    <param name="tmpdir" type="text" optional="true" label="This applications need to write temporary files for each tile. This parameter allows choosing the path where to write those files. If disabled, the current path will be used." help="This applications need to write temporary files for each tile. This parameter allows choosing the path where to write those files. If disabled, the current path will be used."/>
    <param name="cleanup" type="select" optional="false" label="If activated, the application will try to remove all temporary files it created." help="If activated, the application will try to remove all temporary files it created.">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="tiff" label="output_data_out" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="jpeg" value="image/jpeg"/>
        <when input="outputType_out" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <param name="response" value="document"/>
      <output name="output_data_out" ftype="txt" value="output_data_out.txt"/>
    </test>
  </tests>
  <help><![CDATA[This application will produce a labeled image where neighbor pixels whose range distance is below range radius (and optionally spatial distance below spatial radius) will be grouped together into the same cluster. For large images one can use the tilesizex and tilesizey parameters for tile-wise processing, with the guarantees of identical results.Filtered range image and spatial image should be created with the MeanShiftSmoothing application outputs (fout and foutpos) [2], with modesearch parameter disabled. If spatial image is not set, the application will only process the range image and spatial radius parameter will not be taken into account.Please note that this application will generate a lot of temporary files (as many as the number of tiles), and will therefore require twice the size of the final result in term of disk space. The cleanup option (activated by default) allows removing all temporary file as soon as they are not needed anymore (if cleanup is activated, tmpdir set and tmpdir does not exists before running the application, it will be removed as well during cleanup). The tmpdir option allows defining a directory where to write the temporary files.Please also note that the output image type should be set to uint32 to ensure that there are enough labels available.The output of this application can be passed to the LSMSSmallRegionMerging [3] or LSMSVectorization [4] applications to complete the LSMS workflow.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
