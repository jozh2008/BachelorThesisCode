<tool name="OTB.StereoRectificationGridGenerator" id="otb_stereorectificationgridgenerator" version="1.0.0">
  <description>Generates two deformation fields to resample in epipolar geometry, a pair of stereo images up to the sensor model precision</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayio_inleft False  isArrayio_inright False  isArrayepi_elevation_geoid False  output_data_io_outleft $output_data_io_outleft  output_data_io_outright $output_data_io_outright  output_data_epi_elevation_avgdem_value $output_data_epi_elevation_avgdem_value  output_data_epi_elevation_avgdem_mindisp $output_data_epi_elevation_avgdem_mindisp  output_data_epi_elevation_avgdem_maxdisp $output_data_epi_elevation_avgdem_maxdisp  output_data_epi_rectsizex $output_data_epi_rectsizex  output_data_epi_rectsizey $output_data_epi_rectsizey  output_data_epi_baseline $output_data_epi_baseline  output_data_inverse_outleft $output_data_inverse_outleft  output_data_inverse_outright $output_data_inverse_outright  name OTB.StereoRectificationGridGenerator io_inleft $io_inleft
io_inright $io_inright
io_outleft $io_outleft
io_outright $io_outright
epi_elevation_dem '$epi_elevation_dem'
epi_elevation_geoid $epi_elevation_geoid
epi_elevation_default $epi_elevation_default
epi_elevation_avgdem_step $epi_elevation_avgdem_step
epi_scale $epi_scale
epi_step $epi_step
inverse_outleft $inverse_outleft
inverse_outright $inverse_outright
inverse_ssrate $inverse_ssrate
prefer $prefer
response $response
outputType_io_outleft $OutputSection_io_outleft.outputType_io_outleft
transmissionMode_io_outleft $OutputSection_io_outleft.transmissionMode_io_outleft
outputType_io_outright $OutputSection_io_outright.outputType_io_outright
transmissionMode_io_outright $OutputSection_io_outright.transmissionMode_io_outright
transmissionMode_epi_elevation_avgdem_value $OutputSection_epi_elevation_avgdem_value.transmissionMode_epi_elevation_avgdem_value
transmissionMode_epi_elevation_avgdem_mindisp $OutputSection_epi_elevation_avgdem_mindisp.transmissionMode_epi_elevation_avgdem_mindisp
transmissionMode_epi_elevation_avgdem_maxdisp $OutputSection_epi_elevation_avgdem_maxdisp.transmissionMode_epi_elevation_avgdem_maxdisp
transmissionMode_epi_rectsizex $OutputSection_epi_rectsizex.transmissionMode_epi_rectsizex
transmissionMode_epi_rectsizey $OutputSection_epi_rectsizey.transmissionMode_epi_rectsizey
transmissionMode_epi_baseline $OutputSection_epi_baseline.transmissionMode_epi_baseline
outputType_inverse_outleft $OutputSection_inverse_outleft.outputType_inverse_outleft
transmissionMode_inverse_outleft $OutputSection_inverse_outleft.transmissionMode_inverse_outleft
outputType_inverse_outright $OutputSection_inverse_outright.outputType_inverse_outright
transmissionMode_inverse_outright $OutputSection_inverse_outright.transmissionMode_inverse_outright]]></command>
  <inputs>
    <param name="io_inleft" type="data" optional="false" label="The left image from the stereo pair, in sensor geometry." help="The left image from the stereo pair, in sensor geometry. The following data types are allowed in the txt file:  png, jpeg, tiff" format="txt"/>
    <param name="io_inright" type="data" optional="false" label="The right image from the stereo pair, in sensor geometry." help="The right image from the stereo pair, in sensor geometry. The following data types are allowed in the txt file:  png, jpeg, tiff" format="txt"/>
    <param name="io_outleft" type="select" optional="false" label="The deformation grid to resample the left image from sensor geometry to epipolar geometry." help="The deformation grid to resample the left image from sensor geometry to epipolar geometry.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="io_outright" type="select" optional="false" label="The deformation grid to resample the right image from sensor geometry to epipolar geometry." help="The deformation grid to resample the right image from sensor geometry to epipolar geometry.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="epi_elevation_dem" type="text" optional="true" label="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory." help="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory."/>
    <param name="epi_elevation_geoid" type="data" optional="false" label="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd)." help="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd). The following data types are allowed in the txt file:  octet-stream" format="txt"/>
    <param name="epi_elevation_default" type="float" value="0" optional="false" label="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value." help="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value."/>
    <param name="epi_elevation_avgdem_step" type="integer" value="1" optional="true" label="Step of sub-sampling for average elevation estimation" help="Step of sub-sampling for average elevation estimation"/>
    <param name="epi_scale" type="float" value="1" optional="false" label="The scale parameter allows generating zoomed-in (scale &amp;lt; 1) or zoomed-out (scale &gt; 1) epipolar images." help="The scale parameter allows generating zoomed-in (scale &amp;lt; 1) or zoomed-out (scale &gt; 1) epipolar images."/>
    <param name="epi_step" type="integer" value="1" optional="false" label="Stereo-rectification deformation grid only varies slowly. Therefore, it is recommended to use a coarser grid (higher step value) in case of large images" help="Stereo-rectification deformation grid only varies slowly. Therefore, it is recommended to use a coarser grid (higher step value) in case of large images"/>
    <param name="inverse_outleft" type="select" optional="true" label="The deformation grid to resample the left image from the epipolar geometry back into its original sensor geometry." help="The deformation grid to resample the left image from the epipolar geometry back into its original sensor geometry.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="inverse_outright" type="select" optional="true" label="The output deformation grid to resample the right image from the epipolar geometry back into its original sensor geometry." help="The output deformation grid to resample the right image from the epipolar geometry back into its original sensor geometry.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="inverse_ssrate" type="integer" value="16" optional="false" label="Grid inversion is an heavy process that implies spline regression on control points. To avoid eating to much memory, this parameter allows one to first sub-sample the field to invert." help="Grid inversion is an heavy process that implies spline regression on control points. To avoid eating to much memory, this parameter allows one to first sub-sample the field to invert."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_io_outleft" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_io_outleft" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_io_outleft" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_io_outright" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_io_outright" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_io_outright" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_elevation_avgdem_value" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_elevation_avgdem_value" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_elevation_avgdem_mindisp" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_elevation_avgdem_mindisp" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_elevation_avgdem_maxdisp" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_elevation_avgdem_maxdisp" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_rectsizex" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_rectsizex" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_rectsizey" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_rectsizey" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_epi_baseline" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="transmissionMode_epi_baseline" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_inverse_outleft" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_inverse_outleft" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_inverse_outleft" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_inverse_outright" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_inverse_outright" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_inverse_outright" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_io_outleft" format="tiff" label="output_data_io_outleft" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_io_outleft" format="jpeg" value="image/jpeg"/>
        <when input="outputType_io_outleft" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_io_outright" format="tiff" label="output_data_io_outright" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_io_outright" format="jpeg" value="image/jpeg"/>
        <when input="outputType_io_outright" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_epi_elevation_avgdem_value" format="txt" label="output_data_epi_elevation_avgdem_value" hidden="false"/>
    <data name="output_data_epi_elevation_avgdem_mindisp" format="txt" label="output_data_epi_elevation_avgdem_mindisp" hidden="false"/>
    <data name="output_data_epi_elevation_avgdem_maxdisp" format="txt" label="output_data_epi_elevation_avgdem_maxdisp" hidden="false"/>
    <data name="output_data_epi_rectsizex" format="txt" label="output_data_epi_rectsizex" hidden="false"/>
    <data name="output_data_epi_rectsizey" format="txt" label="output_data_epi_rectsizey" hidden="false"/>
    <data name="output_data_epi_baseline" format="txt" label="output_data_epi_baseline" hidden="false"/>
    <data name="output_data_inverse_outleft" format="tiff" label="output_data_inverse_outleft" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_inverse_outleft" format="jpeg" value="image/jpeg"/>
        <when input="outputType_inverse_outleft" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_inverse_outright" format="tiff" label="output_data_inverse_outright" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_inverse_outright" format="jpeg" value="image/jpeg"/>
        <when input="outputType_inverse_outright" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <param name="response" value="document"/>
      <output name="output_data_io_outleft" ftype="txt" value="output_data_io_outleft.txt"/>
      <output name="output_data_io_outright" ftype="txt" value="output_data_io_outright.txt"/>
      <output name="output_data_epi_elevation_avgdem_value" ftype="txt" value="output_data_epi_elevation_avgdem_value.txt"/>
      <output name="output_data_epi_elevation_avgdem_mindisp" ftype="txt" value="output_data_epi_elevation_avgdem_mindisp.txt"/>
      <output name="output_data_epi_elevation_avgdem_maxdisp" ftype="txt" value="output_data_epi_elevation_avgdem_maxdisp.txt"/>
      <output name="output_data_epi_rectsizex" ftype="txt" value="output_data_epi_rectsizex.txt"/>
      <output name="output_data_epi_rectsizey" ftype="txt" value="output_data_epi_rectsizey.txt"/>
      <output name="output_data_epi_baseline" ftype="txt" value="output_data_epi_baseline.txt"/>
      <output name="output_data_inverse_outleft" ftype="txt" value="output_data_inverse_outleft.txt"/>
      <output name="output_data_inverse_outright" ftype="txt" value="output_data_inverse_outright.txt"/>
    </test>
  </tests>
  <help><![CDATA[This application generates a pair of deformation grid to stereo-rectify a pair of stereo images according to sensor modelling and a mean elevation hypothesis.This application is the first part of the stereo reconstruction framework. The output deformation grids can be passed to the GridBasedImageResampling application for actual resampling into epipolar geometry.There are several ways to set the elevation source:  * An arbitrary constant elevation  * A DEM directory  * Compute an average elevation from a DEMIf needed, the application can compute inverse resampling grids (from epipolar to original sensor geometry). Don't forget to check the other outputs from the application. For instance, the application gives the X and Y size of the rectified images, along with an estimated baseline ratio.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
