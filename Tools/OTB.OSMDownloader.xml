<tool name="OTB.OSMDownloader" id="otb_osmdownloader" version="1.0.0">
  <description>Download vector data from OSM and store it to file</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArraysupport False  isArrayelev.geoid False  output_data_out $output_data_out  name OTB.OSMDownloader support $support
key '$key'
value '$value'
elev.dem '$elev.dem'
elev.geoid $elev.geoid
elev.default $elev.default
printclasses $printclasses
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out]]></command>
  <inputs>
    <param name="support" type="data" optional="false" label="Image used to derive the spatial extent to be requested from OSM server (the bounding box of the extent is used). Be aware that a request with a large extent may be rejected by the server." help="Image used to derive the spatial extent to be requested from OSM server (the bounding box of the extent is used). Be aware that a request with a large extent may be rejected by the server. The following data types are allowed in the txt file:  tiff, png, jpeg" format="txt"/>
    <param name="key" type="text" optional="true" label="OSM tag key to extract (highway, building...). It defines a category to select features." help="OSM tag key to extract (highway, building...). It defines a category to select features."/>
    <param name="value" type="text" optional="true" label="OSM tag value to extract (motorway, footway...). It defines the type of feature to select inside a category." help="OSM tag value to extract (motorway, footway...). It defines the type of feature to select inside a category."/>
    <param name="elev.dem" type="text" optional="true" label="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory." help="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory."/>
    <param name="elev.geoid" type="data" optional="false" label="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd)." help="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd). The following data types are allowed in the txt file:  octet-stream" format="txt"/>
    <param name="elev.default" type="float" value="0" optional="false" label="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value." help="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value."/>
    <param name="printclasses" type="select" optional="false" label="Print the key/value classes available for the selected support image. If enabled, the OSM tag Key (-key) and the output (-out) become optional" help="Print the key/value classes available for the selected support image. If enabled, the OSM tag Key (-key) and the output (-out) become optional">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Author did not provide help for this parameter... ">
        <option value="application/json">json</option>
        <option value="application/vnd.google-earth.kml+xml">vnd.google-earth.kml+xml</option>
        <option value="application/zip">zip</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="vnd.google-earth.kml+xml" value="application/vnd.google-earth.kml+xml"/>
        <when input="outputType_out" format="json" value="application/json"/>
        <when input="outputType_out" format="zip" value="application/zip"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" ftype="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[The application connects to Open Street Map server, downloads the data corresponding to the spatial extent of the support image, and filters the geometries based on OSM tags to produce a vector data file.This application can be used to download reference data to perform the training of a machine learning model (see for instance [1]).By default, the entire layer is downloaded. The application has a special mode to provide the list of available classes in the layers. The downloaded features are filtered by giving an OSM tag 'key'. In addition, the user can also choose what 'value' this key should have. More information about the OSM project at [2].]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
