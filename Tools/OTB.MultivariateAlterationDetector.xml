<tool name="OTB.MultivariateAlterationDetector" id="otb_multivariatealterationdetector" version="1.0.0">
  <description>Change detection by Multivariate Alteration Detector (MAD) algorithm</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayin1 False  isArrayin2 False  output_data_out $output_data_out  name OTB.MultivariateAlterationDetector in1 $in1
in2 $in2
out $out
ram $ram
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out]]></command>
  <inputs>
    <param name="in1" type="data" optional="false" label="Multiband image of the scene before perturbations" help="Multiband image of the scene before perturbations The following data types are allowed in the txt file:  jpeg, png, tiff" format="txt"/>
    <param name="in2" type="data" optional="false" label="Mutliband image of the scene after perturbations." help="Mutliband image of the scene after perturbations. The following data types are allowed in the txt file:  jpeg, png, tiff" format="txt"/>
    <param name="out" type="select" optional="false" label="Multiband image containing change maps. Each map will be in the range [-1,1], so a floating point output type is advised." help="Multiband image containing change maps. Each map will be in the range [-1,1], so a floating point output type is advised.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="ram" type="integer" value="128" optional="true" label="Available memory for processing (in MB)" help="Available memory for processing (in MB)"/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_out" type="select" label="Multiband image containing change maps. Each map will be in the range [-1,1], so a floating point output type is advised." help="Multiband image containing change maps. Each map will be in the range [-1,1], so a floating point output type is advised.">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="jpeg" value="image/jpeg"/>
        <when input="outputType_out" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This application performs change detection between two multispectral images using the Multivariate Alteration Detector (MAD) [1] algorithm.The MAD algorithm produces a set of N change maps (where N is the maximum number of bands in first and second input images), with the following properties: - Change maps are differences of a pair of linear combinations of  bands from image 1 and bands from image 2 chosen to maximize the  correlation,  - Each change map is orthogonal to the others. This is a statistical method which can handle different modalities and even different bands and number of bands between images.  The application will output all change maps into a single multiband image. If numbers of bands in image 1 and 2 are equal, then change maps are sorted by increasing correlation. If number of bands is different, the change maps are sorted by decreasing correlation.  The application will also print the following information:- Mean1 and Mean2 which are the mean values of bands for both input images,- V1 and V2 which are the two linear transform that are applied to input image 1 and input image 2 to build the change map,- Rho, the vector of correlation associated to each change map. The OTB filter used in this application has been implemented from the Matlab code kindly made available by the authors here [2]. Both cases (same and different number of bands) have been validated by comparing the output image to the output produced by the Matlab  code, and the reference images for testing have been generated from  the Matlab code using Octave.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
