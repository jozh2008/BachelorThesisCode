<tool name="OTB.FineRegistration" id="otb_fineregistration" version="1.0.0">
  <description>Estimate disparity map between two images.</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayref False  isArraysec False  isArrayw False  output_data_out $output_data_out  output_data_wo $output_data_wo  name OTB.FineRegistration ref $ref
sec $sec
out $out
erx $erx
ery $ery
mrx $mrx
mry $mry
w $w
wo $wo
cox $cox
coy $coy
ssrx $ssrx
ssry $ssry
rgsx $rgsx
rgsy $rgsy
sgsx $sgsx
sgsy $sgsy
m '$m'
spa $spa
cva $cva
vmlt $vmlt
vmut $vmut
ram $ram
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out
outputType_wo $OutputSection_wo.outputType_wo
transmissionMode_wo $OutputSection_wo.transmissionMode_wo]]></command>
  <inputs>
    <param name="ref" type="data" optional="false" label="The reference image." help="The reference image. The following data types are allowed in the txt file:  tiff, png, jpeg" format="txt"/>
    <param name="sec" type="data" optional="false" label="The secondary image." help="The secondary image. The following data types are allowed in the txt file:  tiff, png, jpeg" format="txt"/>
    <param name="out" type="select" optional="false" label="The output image contains 3 bands, for X offset, Y offset and the metric value. It may contain a 4th one with the validity mask (if used)." help="The output image contains 3 bands, for X offset, Y offset and the metric value. It may contain a 4th one with the validity mask (if used).">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="erx" type="integer" optional="false" label="The exploration radius along x (in pixels)" help="The exploration radius along x (in pixels)"/>
    <param name="ery" type="integer" optional="false" label="The exploration radius along y (in pixels)" help="The exploration radius along y (in pixels)"/>
    <param name="mrx" type="integer" optional="false" label="Radius along x (in pixels) of the metric computation window" help="Radius along x (in pixels) of the metric computation window"/>
    <param name="mry" type="integer" optional="false" label="Radius along y (in pixels) of the metric computation window" help="Radius along y (in pixels) of the metric computation window"/>
    <param name="w" type="data" optional="false" label="The image to warp after disparity estimation is completed." help="The image to warp after disparity estimation is completed. The following data types are allowed in the txt file:  tiff, png, jpeg" format="txt"/>
    <param name="wo" type="select" optional="true" label="The output warped image" help="The output warped image">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="cox" type="float" value="0" optional="true" label="Coarse offset along x (in physical space) between the two images, used as an initial offset for all pixels." help="Coarse offset along x (in physical space) between the two images, used as an initial offset for all pixels."/>
    <param name="coy" type="float" value="0" optional="true" label="Coarse offset along y (in physical space) between the two images, used as an initial offset for all pixels." help="Coarse offset along y (in physical space) between the two images, used as an initial offset for all pixels."/>
    <param name="ssrx" type="float" value="1" optional="true" label="Generates a result at a coarser resolution with a given sub-sampling rate along X" help="Generates a result at a coarser resolution with a given sub-sampling rate along X"/>
    <param name="ssry" type="float" value="1" optional="true" label="Generates a result at a coarser resolution with a given sub-sampling rate along Y" help="Generates a result at a coarser resolution with a given sub-sampling rate along Y"/>
    <param name="rgsx" type="float" optional="true" label="Performs a gaussian smoothing of the reference image. Parameter is gaussian sigma (in pixels) in X direction." help="Performs a gaussian smoothing of the reference image. Parameter is gaussian sigma (in pixels) in X direction."/>
    <param name="rgsy" type="float" optional="true" label="Performs a gaussian smoothing of the reference image. Parameter is gaussian sigma (in pixels) in Y direction." help="Performs a gaussian smoothing of the reference image. Parameter is gaussian sigma (in pixels) in Y direction."/>
    <param name="sgsx" type="float" optional="true" label="Performs a gaussian smoothing of the secondary image. Parameter is gaussian sigma (in pixels) in X direction." help="Performs a gaussian smoothing of the secondary image. Parameter is gaussian sigma (in pixels) in X direction."/>
    <param name="sgsy" type="float" optional="true" label="Performs a gaussian smoothing of the secondary image. Parameter is gaussian sigma (in pixels) in Y direction." help="Performs a gaussian smoothing of the secondary image. Parameter is gaussian sigma (in pixels) in Y direction."/>
    <param name="m" type="text" optional="true" label="Choose the metric used for block matching. Available metrics are cross-correlation (CC), cross-correlation with subtracted mean (CCSM), mean-square difference (MSD), mean reciprocal square difference (MRSD) and mutual information (MI). Default is cross-correlation" help="Choose the metric used for block matching. Available metrics are cross-correlation (CC), cross-correlation with subtracted mean (CCSM), mean-square difference (MSD), mean reciprocal square difference (MRSD) and mutual information (MI). Default is cross-correlation"/>
    <param name="spa" type="float" value="0.01" optional="true" label="Metric extrema location will be refined up to the given accuracy. Default is 0.01" help="Metric extrema location will be refined up to the given accuracy. Default is 0.01"/>
    <param name="cva" type="float" value="0.01" optional="true" label="Metric extrema will be refined up to the given accuracy. Default is 0.01" help="Metric extrema will be refined up to the given accuracy. Default is 0.01"/>
    <param name="vmlt" type="float" optional="true" label="Lower threshold to compute the validity mask. This mask will be the 4th output band." help="Lower threshold to compute the validity mask. This mask will be the 4th output band."/>
    <param name="vmut" type="float" optional="true" label="Upper threshold to obtain a validity mask. This mask will be the 4th output band." help="Upper threshold to obtain a validity mask. This mask will be the 4th output band."/>
    <param name="ram" type="integer" value="128" optional="true" label="Available memory for processing (in MB)" help="Available memory for processing (in MB)"/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_wo" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_wo" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_wo" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="jpeg" value="image/jpeg"/>
        <when input="outputType_out" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_wo" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_wo" format="jpeg" value="image/jpeg"/>
        <when input="outputType_wo" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" ftype="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This application computes a disparity map between two images that correspond to the same scene. It is intended for case where small misregistration between images should be estimated and fixed. The search is performed in 2D.The algorithm uses an iterative approach to estimate a best match between local patches. The typical use case is registration betwween similar bands, or between two acquisitions. The output image contains X and Y offsets, as well as the metric value. A sub-pixel accuracy can be expected. The input images should have the same size and same physical space.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
