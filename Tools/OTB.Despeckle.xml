<tool name="OTB.Despeckle" id="otb_despeckle" version="1.0.0">
  <description>Perform speckle noise reduction on SAR image.</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayin False  output_data_out $output_data_out  name OTB.Despeckle in $in
out $out
ram $ram
filter $filter
filter.lee.rad $filter.lee.rad
filter.lee.nblooks $filter.lee.nblooks
filter.frost.rad $filter.frost.rad
filter.frost.deramp $filter.frost.deramp
filter.gammamap.rad $filter.gammamap.rad
filter.gammamap.nblooks $filter.gammamap.nblooks
filter.kuan.rad $filter.kuan.rad
filter.kuan.nblooks $filter.kuan.nblooks
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out]]></command>
  <inputs>
    <param name="in" type="data" optional="false" label="Input image." help="Input image. The following data types are allowed in the txt file:  tiff, jpeg, png" format="txt"/>
    <param name="out" type="select" optional="false" label="Output image." help="Output image.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="ram" type="integer" value="128" optional="true" label="Available memory for processing (in MB)" help="Available memory for processing (in MB)"/>
    <param name="filter" type="select" optional="false" label="filter" help="filter">
      <option value="frost">frost</option>
      <option value="gammamap">gammamap</option>
      <option value="kuan">kuan</option>
      <option selected="true" value="lee">lee</option>
    </param>
    <param name="filter.lee.rad" type="integer" value="1" optional="false" label="Radius in pixel" help="Radius in pixel"/>
    <param name="filter.lee.nblooks" type="float" value="1" optional="false" label="Number of looks in the input image." help="Number of looks in the input image."/>
    <param name="filter.frost.rad" type="integer" value="1" optional="false" label="Radius in pixel." help="Radius in pixel."/>
    <param name="filter.frost.deramp" type="float" value="0.1" optional="false" label="factor use to control theexponential function used to weight effect of the distance between thecentral pixel and its neighborhood. Increasing the deramp parameter willlead to take more into account pixels farther from the center andtherefore increase the smoothing effects." help="factor use to control theexponential function used to weight effect of the distance between thecentral pixel and its neighborhood. Increasing the deramp parameter willlead to take more into account pixels farther from the center andtherefore increase the smoothing effects."/>
    <param name="filter.gammamap.rad" type="integer" value="1" optional="false" label="Radius in pixel." help="Radius in pixel."/>
    <param name="filter.gammamap.nblooks" type="float" value="1" optional="false" label="Number of looks in the input image." help="Number of looks in the input image."/>
    <param name="filter.kuan.rad" type="integer" optional="false" label="Radius in pixel." help="Radius in pixel."/>
    <param name="filter.kuan.nblooks" type="float" optional="false" label="Number of looks in the input image." help="Number of looks in the input image."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Output image." help="Output image.">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="jpeg" value="image/jpeg"/>
        <when input="outputType_out" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[SAR images are affected by speckle noise that inherently exists in and which degrades the image quality. It is caused by the coherent nature of back-scattered waves from multiple distributed targets. It is locally strong and it increases the mean Grey level of a local area. Reducing the speckle noise enhances radiometric resolution but tend to decrease the spatial resolution.Several different methods are used to eliminate speckle noise, based upon different mathematical models of the phenomenon. The application includes four methods: Lee [1], Frost [2], GammaMAP [3] and Kuan [4]. We sum up below the basic principle of this four methods:  * Lee : Estimate the signal by mean square error minimization (MMSE) on a sliding window.  * Frost : Also derived from the MMSE criteria with a weighted sum of the values within the window. The weighting factors decrease with distance from the pixel of interest.  * GammaMAP  : Derived under the assumption of the image follows a Gamma distribution.  * Kuan : Also derived from the MMSE criteria under the assumption of non stationary mean and variance. It is quite similar to Lee filter in form.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
