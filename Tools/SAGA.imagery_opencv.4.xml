<tool name="SAGA.imagery_opencv.4" id="saga_imagery_opencv_4" version="1.0.0">
  <description>Stereo Match (OpenCV)</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayLEFT False  isArrayRIGHT False  output_data_DISPARITY $output_data_DISPARITY  output_data_POINTS $output_data_POINTS  name SAGA.imagery_opencv.4 LEFT $LEFT
RIGHT $RIGHT
ALGORITHM $ALGORITHM
DISP_MIN $DISP_MIN
DISP_NUM $DISP_NUM
BLOCKSIZE $BLOCKSIZE
DIFF_MAX $DIFF_MAX
UNIQUENESS $UNIQUENESS
SPECKLE_SIZE $SPECKLE_SIZE
SPECKLE_RANGE $SPECKLE_RANGE
BM_TEXTURE $BM_TEXTURE
BM_FILTER_CAP $BM_FILTER_CAP
SGBM_MODE $SGBM_MODE
SGBM_P1 $SGBM_P1
SGBM_P2 $SGBM_P2
SGBM_FILTER_CAP $SGBM_FILTER_CAP
prefer $prefer
response $response
outputType_DISPARITY $OutputSection_DISPARITY.outputType_DISPARITY
transmissionMode_DISPARITY $OutputSection_DISPARITY.transmissionMode_DISPARITY
outputType_POINTS $OutputSection_POINTS.outputType_POINTS
transmissionMode_POINTS $OutputSection_POINTS.transmissionMode_POINTS]]></command>
  <inputs>
    <param name="LEFT" type="data" optional="false" label="Left Image" help="Left Image The following data types are allowed in the txt file:  x-ogc-envi, tiff, png, x-ogc-aaigrid" format="txt"/>
    <param name="RIGHT" type="data" optional="false" label="Right Image" help="Right Image The following data types are allowed in the txt file:  x-ogc-envi, tiff, png, x-ogc-aaigrid" format="txt"/>
    <param name="ALGORITHM" type="select" optional="true" label="Algorithm" help="Algorithm">
      <option selected="true" value="Block_Matching">Block Matching</option>
      <option value="Modified_Hirschmuller">Modified Hirschmuller</option>
    </param>
    <param name="DISP_MIN" type="integer" value="0" optional="true" label="Minimum Disparity" help="Minimum possible disparity value. Normally, it is zero but sometimes rectification algorithms can shift images, so this parameter needs to be adjusted accordingly."/>
    <param name="DISP_NUM" type="integer" value="1" optional="true" label="Number of Disparities" help="Maximum disparity minus minimum disparity. The value is always greater than zero."/>
    <param name="BLOCKSIZE" type="integer" value="4" optional="true" label="Block Size" help="The linear size of the blocks compared by the algorithm. Larger block size implies smoother, though less accurate disparity map. Smaller block size gives more detailed disparity map, but there is higher chance for algorithm to find a wrong correspondence."/>
    <param name="DIFF_MAX" type="integer" value="1" optional="true" label="Maximum Disparity Difference" help="Maximum allowed difference (in integer pixel units) in the left-right disparity check. Set it to a non-positive value to disable the check."/>
    <param name="UNIQUENESS" type="integer" value="15" optional="true" label="Uniqueness Ratio" help="Margin in percentage by which the best (minimum) computed cost function value should &quot;win&quot; the second best value to consider the found match correct. Normally, a value within the 5-15 range is good enough."/>
    <param name="SPECKLE_SIZE" type="integer" value="100" optional="true" label="Speckle Window Size" help="Maximum size of smooth disparity regions to consider their noise speckles and invalidate. Set it to 0 to disable speckle filtering. Otherwise, set it somewhere in the 50-200 range."/>
    <param name="SPECKLE_RANGE" type="integer" value="2" optional="true" label="Speckle Range" help="Maximum disparity variation within each connected component. If you do speckle filtering, set the parameter to a positive value, it will be implicitly multiplied by 16. Normally, 1 or 2 is good enough."/>
    <param name="BM_TEXTURE" type="integer" value="31" optional="true" label="Texture Threshold" help="Texture Threshold"/>
    <param name="BM_FILTER_CAP" type="integer" value="31" optional="true" label="Prefilter Truncation Value" help="Truncation value for the prefiltered image pixels."/>
    <param name="SGBM_MODE" type="select" optional="true" label="Mode" help="Mode">
      <option value="HH">HH</option>
      <option value="SGBM_3_Way">SGBM 3 Way</option>
      <option selected="true" value="Semi-Global_Block_Matching">Semi-Global Block Matching</option>
    </param>
    <param name="SGBM_P1" type="integer" value="8" optional="true" label="Disparity Smoothness Parameter 1" help="The larger the value, the smoother the disparity. Parameter 1 is the penalty on the disparity change by plus or minus 1 between neighbor pixels. The algorithm requires Parameter 2 &amp;gt; Parameter 1."/>
    <param name="SGBM_P2" type="integer" value="32" optional="true" label="Disparity Smoothness Parameter 2" help="The larger the value, the smoother the disparity. Parameter 2 is the penalty on the disparity change by more than 1 between neighbor pixels. The algorithm requires Parameter 2 &amp;gt; Parameter 1."/>
    <param name="SGBM_FILTER_CAP" type="integer" value="31" optional="true" label="Prefilter Truncation Value" help="Truncation value for the prefiltered image pixels. The algorithm first computes x-derivative at each pixel and clips its value by [-preFilterCap, preFilterCap] interval. The result values are passed to the Birchfield-Tomasi pixel cost function."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_DISPARITY" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_DISPARITY" type="select" label="Disparity Image" help="Disparity Image">
        <option value="application/x-ogc-aaigrid">x-ogc-aaigrid</option>
        <option value="application/x-ogc-envi">x-ogc-envi</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_DISPARITY" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_POINTS" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_POINTS" type="select" label="Points" help="Points">
        <option value="application/x-ogc-lasf">x-ogc-lasf</option>
      </param>
      <param name="transmissionMode_POINTS" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_DISPARITY" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_DISPARITY" format="x-ogc-envi" value="application/x-ogc-envi"/>
        <when input="outputType_DISPARITY" format="x-ogc-aaigrid" value="application/x-ogc-aaigrid"/>
        <when input="outputType_DISPARITY" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_POINTS" format="x-ogc-lasf" hidden="false"/>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[References:&lt;br/&gt;OpenCV - Open Source Computer Vision&lt;br/&gt;&lt;a target="_blank" href="http://opencv.org"&gt;http://opencv.org&lt;/a&gt;]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
