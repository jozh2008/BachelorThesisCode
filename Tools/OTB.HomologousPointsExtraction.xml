<tool name="OTB.HomologousPointsExtraction" id="otb_homologouspointsextraction" version="1.0.0">
  <description>Compute homologous points between images using keypoints</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayin1 False  isArrayin2 False  isArrayelev.geoid False  output_data_out $output_data_out  output_data_outvector $output_data_outvector  name OTB.HomologousPointsExtraction in1 $in1
band1 $band1
in2 $in2
band2 $band2
algorithm $algorithm
threshold $threshold
backmatching $backmatching
mode $mode
mode.geobins.binsize $mode.geobins.binsize
mode.geobins.binsizey $mode.geobins.binsizey
mode.geobins.binstep $mode.geobins.binstep
mode.geobins.binstepy $mode.geobins.binstepy
mode.geobins.margin $mode.geobins.margin
precision $precision
mfilter $mfilter
2wgs84 $2wgs84
elev.dem '$elev.dem'
elev.geoid $elev.geoid
elev.default $elev.default
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out
outputType_outvector $OutputSection_outvector.outputType_outvector
transmissionMode_outvector $OutputSection_outvector.transmissionMode_outvector]]></command>
  <inputs>
    <param name="in1" type="data" optional="false" label="First input image" help="First input image The following data types are allowed in the txt file:  png, tiff, jpeg" format="txt"/>
    <param name="band1" type="integer" value="1" optional="false" label="Index of the band from input image 1 to use for keypoints extraction" help="Index of the band from input image 1 to use for keypoints extraction"/>
    <param name="in2" type="data" optional="false" label="Second input image" help="Second input image The following data types are allowed in the txt file:  png, tiff, jpeg" format="txt"/>
    <param name="band2" type="integer" value="1" optional="false" label="Index of the band from input image 1 to use for keypoints extraction" help="Index of the band from input image 1 to use for keypoints extraction"/>
    <param name="algorithm" type="select" optional="false" label="Choice of the detection algorithm to use" help="Choice of the detection algorithm to use">
      <option value="sift">sift</option>
      <option selected="true" value="surf">surf</option>
    </param>
    <param name="threshold" type="float" value="0.6" optional="false" label="The distance threshold for matching." help="The distance threshold for matching."/>
    <param name="backmatching" type="select" optional="false" label="If set to true, matches should be consistent in both ways." help="If set to true, matches should be consistent in both ways.">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="mode" type="select" optional="false" label="mode" help="mode">
      <option selected="true" value="full">full</option>
      <option value="geobins">geobins</option>
    </param>
    <param name="mode.geobins.binsize" type="integer" value="256" optional="false" label="Radius of the spatial bin in pixels" help="Radius of the spatial bin in pixels"/>
    <param name="mode.geobins.binsizey" type="integer" optional="true" label="Radius of the spatial bin in pixels (y direction). If not set, the mode.geobins.binsize value is used." help="Radius of the spatial bin in pixels (y direction). If not set, the mode.geobins.binsize value is used."/>
    <param name="mode.geobins.binstep" type="integer" value="256" optional="false" label="Steps between bins in pixels" help="Steps between bins in pixels"/>
    <param name="mode.geobins.binstepy" type="integer" optional="true" label="Steps between bins in pixels (y direction). If not set, the mode.geobins.binstep value is used." help="Steps between bins in pixels (y direction). If not set, the mode.geobins.binstep value is used."/>
    <param name="mode.geobins.margin" type="integer" value="10" optional="false" label="Margin from image border to start/end bins (in pixels)" help="Margin from image border to start/end bins (in pixels)"/>
    <param name="precision" type="float" value="0" optional="false" label="Estimated precision of the colocalisation function in pixels" help="Estimated precision of the colocalisation function in pixels"/>
    <param name="mfilter" type="select" optional="false" label="If enabled, this option allows one to filter matches according to colocalisation from sensor or geographical information, using the given tolerancy expressed in pixels" help="If enabled, this option allows one to filter matches according to colocalisation from sensor or geographical information, using the given tolerancy expressed in pixels">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="2wgs84" type="select" optional="false" label="2wgs84" help="2wgs84">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="elev.dem" type="text" optional="true" label="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory." help="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory."/>
    <param name="elev.geoid" type="data" optional="false" label="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd)." help="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd). The following data types are allowed in the txt file:  octet-stream" format="txt"/>
    <param name="elev.default" type="float" value="0" optional="false" label="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value." help="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Author did not provide help for this parameter... ">
        <option value="text/plain">plain</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_outvector" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_outvector" type="select" label="Author did not provide help for this parameter... ">
        <option value="text/plain">plain</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_outvector" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="plain" value="text/plain"/>
      </change_format>
    </data>
    <data name="output_data_outvector" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_outvector" format="plain" value="text/plain"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" ftype="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This application allows computing homologous points between images using keypoints.  SIFT or SURF keypoints can be used and the band on which keypoints are computed can be set independently for both images. The application offers two modes : the first is the full mode where keypoints are extracted from the full extent of both images (please note that in this mode large image file are not supported). The second mode, called geobins, allows one to set-up spatial binning to get fewer points spread across the entire image. In this mode, the corresponding spatial bin in the second image is estimated using geographical transform or sensor modelling, and is padded according to the user defined precision. Last, in both modes the application can filter matches whose colocalisation in first image exceed this precision. The elevation parameters are to deal more precisely with sensor modelling in case of sensor geometry data. The outvector option allows creating a vector file with segments corresponding to the localisation error between the matches. It can be useful to assess the precision of a registration for instance. The vector file is always reprojected to EPSG:4326 to allow display in a GIS. This is done via reprojection or by applying the image sensor models.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
