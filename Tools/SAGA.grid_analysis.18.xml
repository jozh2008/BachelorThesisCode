<tool name="SAGA.grid_analysis.18" id="saga_grid_analysis_18" version="1.0.0">
  <description>Accumulation Functions</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArraySURFACE False  isArrayINPUT False  isArraySTATE_IN False  isArrayCONTROL False  isArrayCTRL_LINEAR False  output_data_FLUX $output_data_FLUX  output_data_STATE_OUT $output_data_STATE_OUT  name SAGA.grid_analysis.18 SURFACE $SURFACE
INPUT $INPUT
STATE_IN $STATE_IN
CONTROL $CONTROL
CTRL_LINEAR $CTRL_LINEAR
OPERATION $OPERATION
LINEAR $LINEAR
THRES_LINEAR $THRES_LINEAR
prefer $prefer
response $response
outputType_FLUX $OutputSection_FLUX.outputType_FLUX
transmissionMode_FLUX $OutputSection_FLUX.transmissionMode_FLUX
outputType_STATE_OUT $OutputSection_STATE_OUT.outputType_STATE_OUT
transmissionMode_STATE_OUT $OutputSection_STATE_OUT.transmissionMode_STATE_OUT]]></command>
  <inputs>
    <param name="SURFACE" type="data" optional="false" label="Surface" help="Surface used to derive the LDD network, e.g. a DTM. The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="INPUT" type="data" optional="false" label="Input" help="Grid with the input values to accumulate. The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="STATE_IN" type="data" optional="false" label="State t" help="Grid describing the state of each cell at timestep t. The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="CONTROL" type="data" optional="false" label="Operation Control" help="Depending on mode of operation either transport capacity, transport fraction, threshold value or trigger value. The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="CTRL_LINEAR" type="data" optional="false" label="Linear Flow Control Grid" help="The values of this grid are checked against the linear flow threshold to decide on the flow-routing algorithm. The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="OPERATION" type="select" optional="true" label="Operation" help="Select a mode of operation">
      <option value="accucapacityflux_/_state">accucapacityflux / state</option>
      <option selected="true" value="accuflux">accuflux</option>
      <option value="accufractionflux_/_state">accufractionflux / state</option>
      <option value="accuthresholdflux_/_state">accuthresholdflux / state</option>
      <option value="accutriggerflux_/_state">accutriggerflux / state</option>
    </param>
    <param name="LINEAR" type="select" optional="true" label="Switch to Linear Flow" help="Switch from MFD8 to D8 if linear flow threshold is crossed.">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="THRES_LINEAR" type="float" value="0" optional="true" label="Threshold Linear Flow" help="Threshold for linear flow, if exceeded D8 is used."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_FLUX" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_FLUX" type="select" label="Author did not provide help for this parameter... ">
        <option value="application/x-ogc-aaigrid">x-ogc-aaigrid</option>
        <option value="application/x-ogc-envi">x-ogc-envi</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_FLUX" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_STATE_OUT" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_STATE_OUT" type="select" label="Author did not provide help for this parameter... ">
        <option value="application/x-ogc-aaigrid">x-ogc-aaigrid</option>
        <option value="application/x-ogc-envi">x-ogc-envi</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_STATE_OUT" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_FLUX" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_FLUX" format="x-ogc-envi" value="application/x-ogc-envi"/>
        <when input="outputType_FLUX" format="x-ogc-aaigrid" value="application/x-ogc-aaigrid"/>
        <when input="outputType_FLUX" format="png" value="image/png"/>
      </change_format>
    </data>
    <data name="output_data_STATE_OUT" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_STATE_OUT" format="x-ogc-envi" value="application/x-ogc-envi"/>
        <when input="outputType_STATE_OUT" format="x-ogc-aaigrid" value="application/x-ogc-aaigrid"/>
        <when input="outputType_STATE_OUT" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" ftype="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[Provides "accumulation functions" that can be used to e.g. move material over a "local drain direction" (LDD) network. The LDD net is computed for the supplied surface by MFD and D8 flow-routing algorithms. It is possible to switch from MFD to D8 as soon as a threshold is exceeded.&lt;br/&gt;The input to each cell on the grid can be supplied from e.g. time series and the material can be moved over the net in several ways. All of these, except the "accuflux" operation, compute both the flux and the state for a given cell. For time series modelling (batch processing), the state of each cell at time t can be initialized with the previous state t - 1.&lt;br/&gt;The capacity, fraction, threshold and trigger operations compute the fluxes and cell states at time t + 1 according to cell-specific parameters that control the way the flux is computed. The capacity function limits the cell-to-cell flux by a (channel) capacity control; the fraction function transports only a given proportion of material from cell to cell, the threshold function transports material only once a given threshold has been exceeded, and the trigger function transports nothing until a trigger value has been exceeded (at which point all accumulated material in the state of the cell is discharged to its downstream neighbour(s)).&lt;br/&gt;&lt;br/&gt;The following operations are supported:&lt;br/&gt;&lt;br/&gt;	* ACCUFLUX: The accuflux function computes the new state of the attributes for the cell as the sum of the input cell values plus the cumulative sum of all upstream elements draining through the cell.&lt;br/&gt;&lt;br/&gt;	* ACCUCAPACITYFLUX / STATE: The operation modifies the accumulation of flow over the network by a limiting transport capacity given in absolute values.&lt;br/&gt;&lt;br/&gt;	* ACCUFRACTIONFLUX / STATE: The operation limits the flow over the network by a parameter which controls the proportion (0-1) of the material that can flow through each cell.&lt;br/&gt;&lt;br/&gt;	* ACCUTHRESHOLDFLUX / STATE: The operation modifies the accummulation of flow over the network by limiting transport to values greater than a minimum threshold value per cell. No flow occurs if the threshold is not exceeded.&lt;br/&gt;&lt;br/&gt;	* ACCUTRIGGERFLUX / STATE: The operation only allows transport (flux) to occur if a trigger value is exceeded, otherwise no transport occurs and storage accumulates.&lt;br/&gt;&lt;br/&gt;]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
