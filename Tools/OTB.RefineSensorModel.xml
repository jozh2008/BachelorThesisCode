<tool name="OTB.RefineSensorModel" id="otb_refinesensormodel" version="1.0.0">
  <description>Perform least-square fit of a sensor model to a set of tie points</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayingeom False  isArrayinpoints False  isArrayelev.geoid False  output_data_outgeom $output_data_outgeom  output_data_outstat $output_data_outstat  output_data_outvector $output_data_outvector  name OTB.RefineSensorModel ingeom $ingeom
inpoints $inpoints
map $map
map.utm.zone $map.utm.zone
map.utm.northhem $map.utm.northhem
map.epsg.code $map.epsg.code
elev.dem '$elev.dem'
elev.geoid $elev.geoid
elev.default $elev.default
prefer $prefer
response $response
outputType_outgeom $OutputSection_outgeom.outputType_outgeom
transmissionMode_outgeom $OutputSection_outgeom.transmissionMode_outgeom
outputType_outstat $OutputSection_outstat.outputType_outstat
transmissionMode_outstat $OutputSection_outstat.transmissionMode_outstat
outputType_outvector $OutputSection_outvector.outputType_outvector
transmissionMode_outvector $OutputSection_outvector.transmissionMode_outvector]]></command>
  <inputs>
    <param name="ingeom" type="data" optional="false" label="Geom file containing the sensor model to refine" help="Geom file containing the sensor model to refine The following data types are allowed in the txt file:  png, jpeg, tiff" format="txt"/>
    <param name="inpoints" type="data" optional="false" label="Input file containing tie points. Points are stored in following format: row col lon lat. Line beginning with # are ignored." help="Input file containing tie points. Points are stored in following format: row col lon lat. Line beginning with # are ignored. The following data types are allowed in the txt file:  png, jpeg, tiff" format="txt"/>
    <param name="map" type="select" optional="false" label="Defines the map projection to be used." help="Defines the map projection to be used.">
      <option value="epsg">epsg</option>
      <option value="lambert2">lambert2</option>
      <option value="lambert93">lambert93</option>
      <option selected="true" value="utm">utm</option>
      <option value="wgs">wgs</option>
    </param>
    <param name="map.utm.zone" type="integer" value="31" optional="false" label="The zone number ranges from 1 to 60 and allows defining the transverse mercator projection (along with the hemisphere)" help="The zone number ranges from 1 to 60 and allows defining the transverse mercator projection (along with the hemisphere)"/>
    <param name="map.utm.northhem" type="select" optional="false" label="The transverse mercator projections are defined by their zone number as well as the hemisphere. Activate this parameter if your image is in the northern hemisphere." help="The transverse mercator projections are defined by their zone number as well as the hemisphere. Activate this parameter if your image is in the northern hemisphere.">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="map.epsg.code" type="integer" value="4326" optional="false" label="See www.spatialreference.org to find which EPSG code is associated to your projection" help="See www.spatialreference.org to find which EPSG code is associated to your projection"/>
    <param name="elev.dem" type="text" optional="true" label="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory." help="This parameter allows selecting a directory containing Digital Elevation Model files. Note that this directory should contain only DEM files. Unexpected behaviour might occurs if other images are found in this directory."/>
    <param name="elev.geoid" type="data" optional="false" label="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd)." help="Use a geoid grid to get the height above the ellipsoid in case there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles. A version of the geoid can be found on the OTB website(https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb-data/blob/master/Input/DEM/egm96.grd). The following data types are allowed in the txt file:  octet-stream" format="txt"/>
    <param name="elev.default" type="float" value="0" optional="false" label="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value." help="This parameter allows setting the default height above ellipsoid when there is no DEM available, no coverage for some points or pixels with no_data in the DEM tiles, and no geoid file has been set. This is also used by some application as an average elevation value."/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_outgeom" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_outgeom" type="select" label="Geom file containing the refined sensor model" help="Geom file containing the refined sensor model">
        <option value="text/plain">plain</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_outgeom" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_outstat" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_outstat" type="select" label="Output file containing the following info: ref_lon ref_lat elevation predicted_lon predicted_lat x_error_ref(meters) y_error_ref(meters) global_error_ref(meters) x_error(meters) y_error(meters) overall_error(meters)" help="Output file containing the following info: ref_lon ref_lat elevation predicted_lon predicted_lat x_error_ref(meters) y_error_ref(meters) global_error_ref(meters) x_error(meters) y_error(meters) overall_error(meters)">
        <option value="text/plain">plain</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_outstat" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
    <section name="OutputSection_outvector" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_outvector" type="select" label="File containing segments representing residues" help="File containing segments representing residues">
        <option value="text/plain">plain</option>
        <option value="text/xml">xml</option>
      </param>
      <param name="transmissionMode_outvector" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_outgeom" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_outgeom" format="plain" value="text/plain"/>
      </change_format>
    </data>
    <data name="output_data_outstat" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_outstat" format="plain" value="text/plain"/>
      </change_format>
    </data>
    <data name="output_data_outvector" format="xml" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_outvector" format="plain" value="text/plain"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This application reads a geom file containing a sensor model and a text file containing a list of ground control point, and performs a least-square fit of the sensor model adjustable parameters to these tie points. It produces an updated geom file as output, as well as an optional ground control points based statistics file and a vector file containing residues. The output geom file can then be used to ortho-rectify the data more accurately. Plaease note that for a proper use of the application, elevation must be correctly set (including DEM and geoid file). The map parameters allows one to choose a map projection in which the accuracy will be estimated in meters.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
