<tool name="SAGA.imagery_photogrammetry.1" id="saga_imagery_photogrammetry_1" version="1.0.0">
  <description>Colorisation (PC)</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayrgbImage False  isArrayPC_IN False  output_data_PC_OUT $output_data_PC_OUT  name SAGA.imagery_photogrammetry.1 rgbImage $rgbImage
PC_IN $PC_IN
GIVE_TIME $GIVE_TIME
IMG_TIME $IMG_TIME
TIME_DIFF $TIME_DIFF
F $F
W $W
ppX $ppX
ppY $ppY
GIVE_DISTORTIONS $GIVE_DISTORTIONS
K1 $K1
K2 $K2
K3 $K3
Xc $Xc
Yc $Yc
Zc $Zc
omega $omega
kappa $kappa
alpha $alpha
prefer $prefer
response $response
outputType_PC_OUT $OutputSection_PC_OUT.outputType_PC_OUT
transmissionMode_PC_OUT $OutputSection_PC_OUT.transmissionMode_PC_OUT]]></command>
  <inputs>
    <param name="rgbImage" type="data" optional="false" label="RGB Image" help="RGB Image The following data types are allowed in the txt file:  tiff, x-ogc-aaigrid, x-ogc-envi, png" format="txt"/>
    <param name="PC_IN" type="data" optional="false" label="Points to be Colorised" help="Points to be Colorised The following data types are allowed in the txt file:  x-ogc-lasf" format="txt"/>
    <param name="GIVE_TIME" type="select" optional="true" label="Provide Time stamp of Image?" help="Do you wish to provide the time stamp of Image?">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="IMG_TIME" type="float" value="0" optional="true" label="Time stamp of Image" help="Time stamp of Image"/>
    <param name="TIME_DIFF" type="float" value="0" optional="true" label="Time Difference between Image &amp; Points" help="Acceptable Time Difference between Image and Laser Points"/>
    <param name="F" type="float" value="0" optional="true" label="Focal Length (mm)" help="Focal Length in mm"/>
    <param name="W" type="float" value="0" optional="true" label="Pixel Width (um)" help="Pixel Width in micro meters"/>
    <param name="ppX" type="float" value="0" optional="true" label="Principal Point Offset in X (pixles)" help="Principal Point Offset in X"/>
    <param name="ppY" type="float" value="0" optional="true" label="Principal Point Offset in Y (pixels)" help="Principal Point Offset in Y"/>
    <param name="GIVE_DISTORTIONS" type="select" optional="true" label="Provide Radial Distortion Parameters?" help="Do you wish to provide the Radial Distortion Parameters?">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="K1" type="float" value="0" optional="true" label="K1" help="K1"/>
    <param name="K2" type="float" value="0" optional="true" label="K2" help="K2"/>
    <param name="K3" type="float" value="0" optional="true" label="K3" help="K3"/>
    <param name="Xc" type="float" value="0" optional="true" label="Projection Centre - X" help="Projection Centre"/>
    <param name="Yc" type="float" value="0" optional="true" label="Projection Centre - Y" help="Projection Centre"/>
    <param name="Zc" type="float" value="0" optional="true" label="Projection Centre - Z" help="Projection Centre"/>
    <param name="omega" type="float" value="0" optional="true" label="Omega" help="Rotation Angle"/>
    <param name="kappa" type="float" value="0" optional="true" label="Kappa" help="Rotation Angle"/>
    <param name="alpha" type="float" value="0" optional="true" label="Alpha" help="Rotation Angle"/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_PC_OUT" title="Select the appropriate transmission mode for the output format and the output value" expanded="true">
      <param name="outputType_PC_OUT" type="select" label="Colorised Point Cloud" help="Colorised Point Cloud">
        <option value="application/x-ogc-lasf">x-ogc-lasf</option>
      </param>
      <param name="transmissionMode_PC_OUT" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_PC_OUT" format="x-ogc-lasf" hidden="false"/>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This tool attaches the color information from a RGB image to Laser Points.&lt;br/&gt; The RGB Image and the Point Cloud to be colorised are the inputs along with the interior and exterior orientation parameters of the camera. The necessary interior orientation parameters are Focal Length (mm), Pixel Size (um), Principal Point Offsets (pixels) and optionally the Radial Distortion Parameters. The distortion model being used is as follows: &lt;br/&gt;	 x_d = x_u (1 - dR)&lt;br/&gt;	 y_d = y_u (1 - dR) &lt;br/&gt; where, dR = K1 * r_u ^ 2 + K2 * r_u ^ 4 + K3 * r_u ^ 6,&lt;br/&gt; r_u ^ 2  = x_u ^ 2 + y_u ^ 2,&lt;br/&gt; x_u, y_u are the undistorted (corrected) image coordinates in mm,&lt;br/&gt; x_d, y_d are the distorted (observed) image coordinates in mm,&lt;br/&gt; K1 is in [mm ^ -2], K2 is in [mm ^ -4],  K3 is in [mm ^ -6].&lt;br/&gt;The necessary exterior orientation parameters are the coordinates of the Projection Center and the Cardan angles Omega, Kappa and Alpha. The Cardan angles refer to the following transformation between image coordinates (x_image) and global coordinates (X_Global): &lt;br/&gt; x_image = R_1(omega) * R_2(kappa) * R_3(alpha) * X_Global &lt;br/&gt;&lt;br/&gt; [Optional] If the Time Stamp of the RGB Image is given, an acceptable time difference between the points and the image must provided in order to colorise only those points falling that range. If no time is given all points are colorised.&lt;br/&gt; The result is a colorised point cloud.&lt;br/&gt;&lt;br/&gt;]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
