<tool name="OTB.ContrastEnhancement" id="otb_contrastenhancement" version="1.0.0">
  <description>This application is the implementation of the histogram equalization algorithm. It can be used to enhance contrast in an image or to reduce the dynamic of the image without losing too much contrast. It offers several options as a no data value, a contrast limitation factor, a local version of the algorithm and also a mode to equalize the luminance of the image.</description>
  <requirements>
    <requirement version="3.9" type="package">python</requirement>
  </requirements>
  <version_command><![CDATA[interpreter filename.exe --version]]></version_command>
  <command><![CDATA[$__tool_directory__/Code/openapi.py isArrayin False  output_data_out $output_data_out  name OTB.ContrastEnhancement in $in
out $out
bins $bins
hfact $hfact
nodata $nodata
spatial $spatial
spatial.local.h $spatial.local.h
spatial.local.w $spatial.local.w
minmax $minmax
minmax.auto.global $minmax.auto.global
minmax.manual.min $minmax.manual.min
minmax.manual.max $minmax.manual.max
mode $mode
mode.lum.red.ch $mode.lum.red.ch
mode.lum.red.coef $mode.lum.red.coef
mode.lum.green.ch $mode.lum.green.ch
mode.lum.green.coef $mode.lum.green.coef
mode.lum.blue.ch $mode.lum.blue.ch
mode.lum.blue.coef $mode.lum.blue.coef
ram $ram
prefer $prefer
response $response
outputType_out $OutputSection_out.outputType_out
transmissionMode_out $OutputSection_out.transmissionMode_out]]></command>
  <inputs>
    <param name="in" type="data" optional="false" label="Input image." help="Input image. The following data types are allowed in the txt file:  jpeg, tiff, png" format="txt"/>
    <param name="out" type="select" optional="false" label="Output image." help="Output image.">
      <option value="double">double</option>
      <option selected="true" value="float">float</option>
      <option value="int16">int16</option>
      <option value="int32">int32</option>
      <option value="uint16">uint16</option>
      <option value="uint8">uint8</option>
    </param>
    <param name="bins" type="integer" value="256" optional="false" label="Number of bins in the histogram" help="Number of bins in the histogram"/>
    <param name="hfact" type="float" optional="true" label="This parameter will set the maximum height accepted in a bin on the input image histogram. The maximum height will be computed as hfact*eqHeight where eqHeight is the height of the theoretical flat histogram. The higher hfact, the higher the contrast.When using 'luminance mode', it is recommended to limit this factor to a small value (ex: 4)" help="This parameter will set the maximum height accepted in a bin on the input image histogram. The maximum height will be computed as hfact*eqHeight where eqHeight is the height of the theoretical flat histogram. The higher hfact, the higher the contrast.When using 'luminance mode', it is recommended to limit this factor to a small value (ex: 4)"/>
    <param name="nodata" type="float" optional="true" label="If there is a value in the image that has no visualization meaning, it can be ignored by the algorithm." help="If there is a value in the image that has no visualization meaning, it can be ignored by the algorithm."/>
    <param name="spatial" type="select" optional="false" label="spatial" help="spatial">
      <option value="global">global</option>
      <option selected="true" value="local">local</option>
    </param>
    <param name="spatial.local.h" type="integer" value="256" optional="false" label="Height of the thumbnail over which the histogram will be computed. The value is in pixels." help="Height of the thumbnail over which the histogram will be computed. The value is in pixels."/>
    <param name="spatial.local.w" type="integer" value="256" optional="false" label="Width of the thumbnail over which the histogram will be computed. The value is in pixels." help="Width of the thumbnail over which the histogram will be computed. The value is in pixels."/>
    <param name="minmax" type="select" optional="false" label="Minimum and maximum value that will bound the histogram and thus the dynamic of the resulting image. Values over those boundaries will be clipped." help="Minimum and maximum value that will bound the histogram and thus the dynamic of the resulting image. Values over those boundaries will be clipped.">
      <option selected="true" value="auto">auto</option>
      <option value="manual">manual</option>
    </param>
    <param name="minmax.auto.global" type="select" optional="false" label="Min/max computation will result in the same minimum and maximum for all the bands." help="Min/max computation will result in the same minimum and maximum for all the bands.">
      <option selected="true" value="false">false</option>
      <option value="true">true</option>
    </param>
    <param name="minmax.manual.min" type="float" optional="true" label="minmax.manual.min" help="minmax.manual.min"/>
    <param name="minmax.manual.max" type="float" optional="true" label="minmax.manual.max" help="minmax.manual.max"/>
    <param name="mode" type="select" optional="false" label="mode" help="mode">
      <option selected="true" value="each">each</option>
      <option value="lum">lum</option>
    </param>
    <param name="mode.lum.red.ch" type="integer" value="0" optional="false" label="mode.lum.red.ch" help="mode.lum.red.ch"/>
    <param name="mode.lum.red.coef" type="float" value="0.21" optional="false" label="mode.lum.red.coef" help="mode.lum.red.coef"/>
    <param name="mode.lum.green.ch" type="integer" value="1" optional="false" label="mode.lum.green.ch" help="mode.lum.green.ch"/>
    <param name="mode.lum.green.coef" type="float" value="0.71" optional="false" label="mode.lum.green.coef" help="mode.lum.green.coef"/>
    <param name="mode.lum.blue.ch" type="integer" value="2" optional="false" label="mode.lum.blue.ch" help="mode.lum.blue.ch"/>
    <param name="mode.lum.blue.coef" type="float" value="0.08" optional="false" label="mode.lum.blue.coef" help="mode.lum.blue.coef"/>
    <param name="ram" type="integer" value="128" optional="true" label="Available memory for processing (in MB)" help="Available memory for processing (in MB)"/>
    <param name="prefer" type="select" label="Choose the Prefer">
      <option selected="true" value="respond-async;return=representation">respond-async;return=representation</option>
      <option value="return=minimal">return=minimal</option>
      <option value="return=representation">return=representation</option>
    </param>
    <param name="response" type="select" label="Response Type" help="Choose 'raw' for raw data or 'document' for document data.">
      <option selected="true" value="document">document</option>
      <option value="raw">raw</option>
    </param>
    <section name="OutputSection_out" title="Select the appropriate transmission mode for the output format" expanded="true">
      <param name="outputType_out" type="select" label="Author did not provide help for this parameter... ">
        <option value="image/jpeg">jpeg</option>
        <option value="image/png">png</option>
        <option value="image/tiff">tiff</option>
      </param>
      <param name="transmissionMode_out" type="select" label="Choose the transmission mode">
        <option selected="true" value="reference">reference</option>
        <option value="value">value</option>
      </param>
    </section>
  </inputs>
  <outputs>
    <data name="output_data_out" format="tiff" hidden="false">
      <change_format>
        <when input="response" format="txt" value="document"/>
        <when input="outputType_out" format="jpeg" value="image/jpeg"/>
        <when input="outputType_out" format="png" value="image/png"/>
      </change_format>
    </data>
  </outputs>
  <tests>
    <test>
      <output name="output_data" value="txt"/>
      <param name="response" value="document"/>
    </test>
  </tests>
  <help><![CDATA[This application is the implementation of the histogram equalization algorithm. The idea of the algorithm is to use the whole available dynamic. In order to do so it computes a histogram over the image and then use the whole dynamic: meaning flattening the histogram. That gives us gain for each bin that transform the original histogram into the flat one. This gain is then apply on the original image.The application proposes several options to allow a finer result: - There is an option to limit contrast. We choose to limit the contrast by modifying the original histogram. To do so we clip the histogram at a given height and redistribute equally among the bins the clipped population. Then we add a local version of the algorithm. - It is possible to apply the algorithm on tiles of the image, instead of on the whole image. That gives us gain depending on the value of the pixel and its position in the image. In order to smoothen the result we interpolate the gain between tiles.]]></help>
  <citations>
    <citation type="bibtex">Josh</citation>
  </citations>
</tool>
